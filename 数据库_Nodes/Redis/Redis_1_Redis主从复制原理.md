# Redis主从复制原理

## 主从同步的过程

- 从节点执行slaveof命令
- 从节点内部定时任务不断监听主节点信息，如果发现主节点，则开始通过socket发起连接
- 连接建立成功后，发送ping命令，如果没有收到pong，就会发起重连
- 权限验证
- 开始同步数据集，主节点把所有数据发送给从节点
- 当主节点把数据同步给从节点后，便完成了复制建立的流程，之后主节点会持续把写命令发送给从节点，保证主从数据一致性

- 主从节点都会维护一个自身的复制偏移量，从节点每秒都会上报自身的复制偏移量给主节点，因此主节点也会保存从节点的复制偏移量。通过对比主从节点的复制偏移量，可以判断主从节点数据是否一致
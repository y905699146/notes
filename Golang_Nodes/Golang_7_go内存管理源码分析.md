# Golang 内存管理分析
Go的内存分配器采用了跟tcmalloc库相同的实现，是一个带内存池的分配器，底层直接调用操作系统的mmap等函数。内存池会向操作系统申请大块内存，然后自己管理这部分内存。上层任务释放内存时不实际归还给操作系统，会放到内存池重复利用。为了避免内存碎片，会有各种分配算法，如操作系统中的首次适应，最佳适应，最差适应，伙伴算法。另外还得考虑在多线程下的稳定效率问题。
为了避免加锁，做法是每个线程都有自己的本地内存。然后有一个全局分配链，当某个线程内存不足就向全局分配链中申请内存，这样就避免了多线程同时访问共享变量时的加锁。在避免内存碎片方面，大块内存按页分配，小块内存会切成各种不同的固定大小的块，申请内存时会按照大小向上取整到最接近的块，按块分配给申请者以避免随意切割。
# 闭包

闭包 通常是一个持有外部环境变量的函数。
Rust 闭包定义(和C++中的类似)：
```
let a = |x : i32 | -> i32{ x+1 }; 

```

闭包可以引用外部环境变量：
```
fn main() {
    let num = 2;
    let plus_one = |x: i32| -> i32 { x + num };//在作用域引用外部的num
    let a = plus_one(1);
    println!("{}",a);
}
```
但是闭包在借用外部环境变量时，外部不能借用，除非闭包脱离当前作用域
```
et mut num = 5;
let plus_num = |x: i32| x + num;

let y = &mut num;  //报错
```

正确做法
```
et mut num = 5;
{
    let plus_num = |x: i32| x + num;      //脱离当前作用域之后可以使用
}
let y = &mut num;
```

## move闭包
Rust 针对闭包提供了一个关键字move ，使用此关键字的作用是强制让闭包所定义环境的自由变量转移到闭包中


## 闭包的三种形式

闭包表达式会由编译器自动翻译为结构体实例，并为其实现Fn,FnMut,FnOnce三个trait中的一个。
- Fn : 表示闭包以不可借用的方式来捕获环境中的自由变量，同时表示闭包没有改变环境中的能力，并且可以多次调用。对应 &self。
- FnMut : 表示闭包以可变借用的方式捕获环境中的自由变量，同时意味着闭包有改变环境的能力，并且可以多次调用。对应 &mut self。
- FnOnce : 表示闭包通过转移所有权来捕获环境中的自由变量，同时意味着该闭包有改变环境的能力，只能调用一次，对应 self